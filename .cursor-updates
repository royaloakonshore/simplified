# .cursor-updates

- Temporarily remove OrderForm and Invoices page to resolve build errors
- Refactored `OrdersPage` to wrap the part using `useSearchParams` in `<Suspense>`, fixing the build error.
- Implemented initial Invoice list page (`/invoices`) with tRPC backend, Shadcn DataTable, filtering, sorting, and pagination.
- Restored OrderForm component (`src/components/orders/OrderForm.tsx`) using separate form instances for create/edit modes to handle type complexity.
- Added Order creation page (`src/app/(erp)/orders/add/page.tsx`) using Server Component pattern to fetch data.
- Added Order edit page (`src/app/(erp)/orders/[id]/edit/page.tsx`) using Server Component pattern.
- Fixed `order.list` tRPC endpoint to handle optional status filter correctly.
- Added `order.update` tRPC endpoint.
- Added webpack fallbacks to `next.config.mjs` to resolve `nodemailer` build issues.
- Replaced basic ERP layout sidebar with collapsible shadcn/ui Sidebar component.
- Created `AppSidebar` component for sidebar structure and navigation items.
- Updated listOrdersSchema to use .nullish() for status filter to fix tRPC errors.
- Add explicit types for form values/instances in OrderForm.tsx and attempt to fix react-hook-form conflicts.
- Fix order list tRPC null status query, implement breadcrumbs, rename fulfillment to production, add firstName to user, implement Kanban board.
- Resolve parallel pages error, restore customer page, update docs, draft multi-tenancy plan.
- Fix nodemailer build error trigger, fix page layout inconsistencies, add first-admin logic.
- Fixed build error in `orders/[id]/edit` page caused by Next.js 15 async `params` change.
- Resolved subsequent TypeScript error in `OrderForm` related to `setValue`/`watch` union types.
- Implemented shadcn styled Sign In page for NextAuth (Email/Credentials).
- Added middleware redirect from root to /dashboard for authenticated users.
- Added Settings page with profile/password update forms and tRPC endpoints.
- Configured NextAuth Credentials provider using bcryptjs.
- Re-added webpack fallbacks for Node built-ins in `next.config.mjs` to resolve build errors caused by NextAuth Email provider dependency.
- Performed clean install (`rm -rf .next node_modules && npm install`) to resolve persistent build errors related to Node built-ins.
- Fixed runtime error on invoice detail page caused by Next.js 15 async `params` change.
- Created `invoices/add` page and placeholder `InvoiceForm` component to fix routing error.
- Implemented the basic InvoiceForm component with react-hook-form and shadcn UI.
- Added Zod schema for invoice creation (`CreateInvoiceSchema`).
- Created tRPC router (`invoiceRouter`) with a `create` mutation including sequential number generation and total calculation.
- Added `invoiceRouter` to the root `appRouter`.
- Updated `AddInvoicePage` to fetch necessary data (customers, inventory items with SKU) and pass to `InvoiceForm`.
- Added shadcn `Calendar` component.
- Temporarily commented out NextAuth EmailProvider to resolve persistent `nodemailer` build error.
- Fixed multiple type errors in `InvoiceListContent` related to data structure changes from `invoice.list` tRPC procedure and component state management.
- Implemented OrderType feature (quotation/work_order) in schema, forms, and UI with proper validation, defaults, and visual indicators.
- Implemented discount and VAT reverse charge enhancements for invoices, including UI updates in `InvoiceForm.tsx`, schema changes, and tRPC router logic modifications. Corrected `Decimal.js` usage and fixed related build errors.
- Updated `finvoice.service.ts` to correctly include discounts and handle VAT reverse charge in Finvoice XML generation.
- Fixed NextAuth JWT and session callback type errors by ensuring consistent `UserRole` type usage from `@/lib/auth`.
- Refactored `src/app/api/auth/[...nextauth]/route.ts` to import `authOptions` from `@/lib/auth` to resolve build errors and centralize configuration.
- Changed NextAuth session strategy to "jwt" in `src/lib/auth/index.ts` to resolve `CALLBACK_CREDENTIALS_JWT_ERROR` for Credentials provider.
- Fixed sign-out flow by correcting button action in ERP layout and renaming signout page to logout to avoid conflicts.
- Integrated existing CustomerForm component into the AddCustomerPage.
- Wrapped AuthErrorPage content in Suspense to resolve build error related to useSearchParams.
- Redesigned sign-in page using `login-04` shadcn-ui block, integrating existing auth logic.
- Feat: Add originui/table, sidebar-07, and originui/dialog components via shadcn CLI.
- Feat: Integrate sidebar-07, update navigation links and user info from session.
- Feat: Implement Customer Edit Dialog using CustomerForm and originui/dialog.
- Feat: Implement Y-tunnus (Finnish Business ID) search in CustomerForm.
- Feat: Refactor CustomerTable with advanced data table components (toolbar, client-side filtering/sorting, column visibility).
- Resolved `PageNotFoundError` by creating `src/app/(erp)/customers/add/page.tsx` for adding new customers.
- Fix: Resolve CustomerTable Hook errors by refactoring hook usage.
- Feat: Add CustomerTableSkeleton for improved loading UI on customers page.
- Fix: Resolve build errors by updating date-fns, react-day-picker, and adapting calendar component to react-day-picker v9 API. Re-enabled NextAuth EmailProvider.
- Fix: Resolve Prisma client & React import build errors. Improve customer page skeleton.
- Feat: Integrate inventory list/add pages. Add 'New Customer' modals to Order/Invoice forms.
- Feat: Update ERP layout top bar for collapsible sidebar trigger. Add haydenbleasel/kanban component.
- Fixed build errors by adding `deliveryDate` to Order schema, correcting Prisma includes and mappings in tRPC routers for orders and invoices, and resolving type issues in invoice actions.
- Analyzed and verified Production Kanban View functionality; updated `listProductionView` to include 'shipped' status orders.
- Fix: Resolve Decimal serialization error when adding items to order.
- Updated `docs/07-enhancement-plan-invoice-order.md` with new inventory and BOM feature requests.
- Refactored ERP layout to use a client component for sidebar state management, fixing build error. Sidebar collapse is now controlled by a header button.
- Refactored Kanban board: excluded pricing from production view payload and corrected inventory deduction logic to trigger on 'in_production' status, deduct BOM components, and allow negative stock for production.
- Fixed linter errors related to `isLoading` vs `isPending` and tRPC utils.
- Regenerated Prisma client to resolve `userId` issues in invoice router.
- Restored and fixed `EditInventoryItemPage` and updated `AddInventoryItemPage` for `InventoryItemForm` prop changes.
- Corrected dashboard page path to `src/app/(erp)/dashboard/page.tsx` and created a basic structure.
- Added `originui/calendar` and created placeholder components for `DateRangePicker`, `PlaceholderAreaChart`, `PlaceholderRecentOrdersTable`, and `PlaceholderReplenishmentTable` for the dashboard.
- Updated `docs/06-ui-and-feature-roadmap.md` with a detailed plan for dashboard enhancements.
- Fixed `Invoice.userId` database schema mismatch with `prisma migrate`.
- Corrected main layout to be full-width using `SidebarInset` in `ERPLayoutClient`.
- Adjusted dashboard page layout: stacked tables, added `DashboardSiteHeader`.
- Refined sidebar logo text hiding on collapse in `AppSidebar`.
- Added "New Customer" as a sub-item to the sidebar under "Customers".
- Resolved `_document` PageNotFoundError build issue with a clean build.
